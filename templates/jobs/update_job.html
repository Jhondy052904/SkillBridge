{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Job | SkillBridge</title>

    <link rel="stylesheet" href="{% static 'css/jobs/job_update.css' %}?v=3">

</head>

<body>

    <a href="{% url 'official_dashboard' %}" class="back-button">â†© Back</a>

    <div class="center-wrapper">
        <h1 class="title">Edit Job</h1>

        {% if messages %}
        <div class="message-wrapper">
            {% for message in messages %}
                <div class="message-box 
                    {% if message.tags == 'success' %} msg-success
                    {% elif message.tags == 'error' %} msg-error
                    {% elif message.tags == 'warning' %} msg-warning
                    {% else %} msg-default {% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="form-container">

            <form method="POST" class="form-fields">
                {% csrf_token %}

                <div class="input-group">
                    <label class="label">Job Title</label>
                    <input type="text" name="title" value="{{ job.Title }}" class="input" required>
                </div>

                <div class="input-group">
                    <label class="label">Description</label>
                    <textarea name="description" class="textarea" rows="4" required>{{ job.Description }}</textarea>
                </div>

                <div class="input-group">
                    <label class="label">Status</label>
                    <select name="status" class="select" required>
                        <option value="Open" {% if job.Status == 'Open' %}selected{% endif %}>Open</option>
                        <option value="Closed" {% if job.Status == 'Closed' %}selected{% endif %}>Closed</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="label">Required Skills</label>

                    <div id="skills-container" class="skills-grid">
                        {% for skill in skills %}
                        <button type="button" 
                            class="skill-btn {% if skill.SkillID in job_skill_ids %} skill-selected {% else %} skill-normal {% endif %}"
                            data-skill-id="{{ skill.SkillID }}">
                            {{ skill.SkillName }}
                        </button>
                        {% endfor %}
                    </div>

                    <div id="hidden-skills">
                        {% for skill_id in job_skill_ids %}
                        <input type="hidden" name="skills" value="{{ skill_id }}">
                        {% endfor %}
                    </div>

                    <p class="helper-text">Click to select/deselect skills.</p>
                </div>

                <button class="save-button">Save Job</button>

            </form>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const skillsContainer = document.getElementById('skills-container');
            const hiddenSkills = document.getElementById('hidden-skills');

            skillsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('skill-btn')) {
                    const tile = e.target;
                    const skillId = tile.dataset.skillId;

                    if (tile.classList.contains('skill-selected')) {
                        tile.classList.remove('skill-selected');
                        tile.classList.add('skill-normal');
                        const input = hiddenSkills.querySelector(`input[value="${skillId}"]`);
                        if (input) input.remove();
                    } else {
                        tile.classList.add('skill-selected');
                        tile.classList.remove('skill-normal');
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'skills';
                        input.value = skillId;
                        hiddenSkills.appendChild(input);
                    }
                }
            });
        });
    </script>

</body>
</html>

