{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Job Listings | SkillBridge</title>
    <link rel="stylesheet" href="{% static 'css/jobs/list_jobs.css' %}?v=3">
    <link rel="stylesheet" href="{% static 'css/registration/logout.css' %}?v=3">
</head>

<body>

<!-- ====================== NAVBAR ====================== -->
<nav class="navbar">
  <div class="nav-left">
    <a href="#" class="logo-link">
      <img src="/static/images/Skillogo.png" alt="Skill Bridge Logo" class="logo">
    </a>
  </div>
  <div class="nav-right">
    <a href="{% url 'home' %}">Dashboard</a>
    <a href="{% url 'list_jobs' %}" class="active">Jobs</a>
    <a href="{% url 'list_trainings' %}">Trainings</a>
    <div class="underline"></div>
    <a>|</a>
    <a href="{% url 'edit_profile' %}">Profile</a>
    <a href="{% url 'login' %}" id="logoutLink">Logout</a>

  </div>
</nav>

<!-- ====================== MAIN ====================== -->
<main>

    <!-- ================= ALERTS ================= -->
    {% if messages %}
    <div>
        {% for message in messages %}
            <div>
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ================= WELCOME ================= -->
    <div>
        <h2 class="section-title">Hello {{ user.first_name }}! Ready to land a new job?</h2>
        <p class="section-subtitle">Explore open positions and apply now.</p>
    </div>

    <!-- ================= SEARCH ================= -->
    <div>
        <input type="text" id="searchInput" placeholder="Search jobs...">

        <select id="filterSelect">
            <option value="">All Types</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Services">Services</option>
            <option value="Full-Time">Full-Time</option>
            <option value="Part-Time">Part-Time</option>
            <option value="Internship">Internship</option>
            <option value="Freelance">Freelance</option>
        </select>

        <button onclick="filterJobs()">Search</button>
    </div>

    <!-- ================= JOB LIST ================= -->
<section>
    <h2 class="section-title">Available Jobs</h2>

    <div id="jobList">
        {% for job in jobs %}
            {% if job.Status == "Open" %}
            <div class="job-card" data-type="{% if job.Title == 'Senior Python Developer' %}Full-Time,All Types{% else %}All Types{% endif %}">
                <h3>{{ job.Title }}</h3>
                
                <p class="job-meta">
                    <strong>Company:</strong> {{ job.Company }} |
                    <strong>Type:</strong> {{ job.JobType }} |
                    <strong>Location:</strong> {{ job.Location }}
                </p>

                <p>{{ job.Description|truncatechars:120 }}</p>
                <p class="job-date">Posted: {{ job.dateposted|date:"M d, Y" }}</p>

                <form method="POST" action="{% url 'apply_job' job.JobID %}">
                    {% csrf_token %}
                    <button>Apply</button>
                </form>
            </div>
            {% endif %}
        {% empty %}
            <p>No job postings available.</p>
        {% endfor %}
    </div>
</section>


    <!-- ================= SIDEBAR WIDGETS ================= -->
    <section>
        <h2 class="section-title">Overview</h2>

        <div>
            <div>
                <p id="current-date"></p>
                <p id="current-time"></p>
            </div>

            <div>
                <canvas id="analyticsChart"></canvas>
            </div>

            <div>
                <div id="jobCalendar"></div>
            </div>
        </div>
    </section>

</main>

<!-- =============== DATA FOR JS =============== -->
<script>
const jobData = [
    {% for job in jobs %}
        { title: "{{ job.Title|escapejs }}", start: "{{ job.dateposted|date:'Y-m-d' }}" },
    {% endfor %}
];

const counts = {
    users: {{ user_count|default:0 }},
    jobs: {{ job_count|default:0 }},
    applications: {{ application_count|default:0 }}
};
</script>

<!-- JS FILES -->
<script src="{% static 'js/joblist/joblist.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    
const menuLinks = document.querySelectorAll('.nav-right a');
const underline = document.querySelector('.nav-right .underline');

function moveUnderline(el) {
    const rect = el.getBoundingClientRect();
    const parentRect = el.closest('.nav-right').getBoundingClientRect();
    underline.style.width = rect.width + 'px';
    underline.style.left = (rect.left - parentRect.left) + 'px';
}

// Initialize on active link
const activeLink = document.querySelector('.nav-right a.active');
if (activeLink) moveUnderline(activeLink);

// Hover effect
menuLinks.forEach(link => {
    link.addEventListener('mouseenter', e => moveUnderline(e.target));
});

// Reset to active link on mouse leave
document.querySelector('.nav-right').addEventListener('mouseleave', () => {
    if (activeLink) moveUnderline(activeLink);

    
});

//logout 
const logoutLink = document.getElementById('logoutLink');

logoutLink.addEventListener('click', function(e) {
    e.preventDefault(); // prevent default navigation

    // Create pop-up container
    const popup = document.createElement('div');
    popup.className = 'logout-popup';
    popup.innerHTML = `
        <p>End Session?</p>
        <div class="popup-buttons">
            <button id="confirmLogout">Yes</button>
            <button id="cancelLogout">No</button>
        </div>
    `;
    document.body.appendChild(popup);

    // Button actions
    document.getElementById('confirmLogout').addEventListener('click', () => {
        window.location.href = logoutLink.href; // proceed to logout
    });

    document.getElementById('cancelLogout').addEventListener('click', () => {
        popup.remove(); // close popup
    });
});

</script>
</body>
</html>
