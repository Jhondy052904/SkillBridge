{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Job Listings | SkillBridge</title>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <style>
        .soft-bg {
            background: linear-gradient(135deg, #f7f5ff, #eff3ff);
        }
    </style>
</head>

<body class="soft-bg min-h-screen flex text-gray-900">

<!-- ====================== SIDEBAR ====================== -->
<aside class="w-64 bg-white border-r shadow-md p-6 hidden md:block">
    <h2 class="text-2xl font-bold mb-8 text-purple-700">SkillBridge</h2>

    <nav class="space-y-2 font-medium">
        <a href="{% url 'home' %}" class="block p-3 rounded-lg hover:bg-purple-50">Dashboard</a>
        <a href="{% url 'list_jobs' %}" class="block p-3 rounded-lg bg-purple-600 text-white">Jobs</a>
        <a href="{% url 'list_trainings' %}" class="block p-3 rounded-lg hover:bg-purple-50">Trainings</a>
        
    </nav>

    <div class="mt-auto pt-8">
        <a href="{% url 'logout' %}"
           class="block bg-red-500 hover:bg-red-600 text-white text-center p-3 rounded-lg">
           Logout
        </a>
    </div>
</aside>



<!-- ====================== MAIN ====================== -->
<main class="flex-1 p-6 md:p-10">

    <!-- HEADER -->
    <header class="flex justify-between items-center mb-10">
        <h1 class="text-3xl font-bold">Job Listings</h1>

        <!-- Mobile back -->
        <button onclick="window.location.href='{% url 'home' %}'"
            class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 md:hidden">
            â¬… Back
        </button>
    </header>


    <!-- ================= ALERTS ================= -->
    {% if messages %}
    <div class="mb-6">
        {% for message in messages %}
            <div class="p-3 rounded text-white mb-2
            {% if message.tags == 'success' %} bg-green-600
            {% elif message.tags == 'error' %} bg-red-600
            {% elif message.tags == 'warning' %} bg-yellow-500 text-black
            {% else %} bg-purple-600 {% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}



    <!-- ================= WELCOME ================= -->
    <div class="bg-white rounded-2xl p-6 shadow-md border-l-4 border-purple-500 mb-10">
        <h2 class="text-xl font-bold">
            Hello {{ user.first_name }}! Ready to land a new job?
        </h2>
        <p class="text-gray-600">Explore open positions and apply now.</p>
    </div>



    <!-- ================= SEARCH ================= -->
    <div class="mb-6 flex gap-2">
        <input type="text"
            id="searchInput"
            placeholder="Search jobs..."
            class="flex-1 md:w-96 border px-4 py-2 rounded-lg shadow-sm"
        >
        <button onclick="filterJobs()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
            Search
        </button>
    </div>



    <!-- ================= JOB LIST ================= -->
    <section>
        <h2 class="text-2xl font-bold mb-4">Available Jobs</h2>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="jobList">
            {% for job in jobs %}
                {% if job.Status == "Open" %}
                <div class="bg-white p-6 rounded-2xl shadow border hover:shadow-lg transition job-card">
                    <h3 class="text-xl font-semibold">{{ job.Title }}</h3>
                    <p class="text-gray-600 text-sm mt-2">{{ job.Description|truncatechars:120 }}</p>

                    <p class="text-xs text-gray-500 mt-1">Posted: {{ job.dateposted|date:"M d, Y" }}</p>

                    <form method="POST" action="{% url 'apply_job' job.JobID %}" class="mt-4">
                        {% csrf_token %}
                        <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg w-full">
                            Apply
                        </button>
                    </form>
                </div>
                {% endif %}
            {% empty %}
                <p class="text-gray-500 italic">No job postings available.</p>
            {% endfor %}
        </div>
    </section>



    <!-- ================= SIDEBAR WIDGETS ================= -->
    <section class="mt-16">
        <h2 class="text-2xl font-bold mb-6">Overview</h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white rounded-2xl p-6 shadow border">
                <p id="current-date" class="text-lg font-semibold"></p>
                <p id="current-time" class="text-gray-500"></p>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow border col-span-2">
                <canvas id="analyticsChart"></canvas>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow border col-span-3">
                <div id="jobCalendar"></div>
            </div>
        </div>
    </section>

</main>



<!-- =============== DATA FOR JS =============== -->
<script>
const jobData = [
    {% for job in jobs %}
        { title: "{{ job.Title|escapejs }}", start: "{{ job.dateposted|date:'Y-m-d' }}" },
    {% endfor %}
];

const counts = {
    users: {{ user_count|default:0 }},
    jobs: {{ job_count|default:0 }},
    applications: {{ application_count|default:0 }}
};
</script>


<!-- =============== JS FILES =============== -->
<script src="{% static 'js/joblist/joblist.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
