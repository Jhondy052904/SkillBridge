{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ page_title|default:"Calendar" }}</title>

    <!-- Keep your home.css so styling matches -->
    <link rel="stylesheet" href="{% static 'css/global-font.css' %}?v=1">
    <link rel="stylesheet" href="{% static 'css/registration/home.css' %}?v=6">

    <!-- FullCalendar (CSS + JS) from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <style>
        /* small style to fit into your layout */
        .calendar-wrapper {
            width: 92%;
            max-width: 1400px;
            margin: 24px auto 80px auto;
        }
        .calendar-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:12px;
            margin-bottom:18px;
        }
        .calendar-title { font-size:1.6rem; font-weight:600; color:#2D3748; }
        #calendar { background: rgba(255,255,255,0.98); padding:18px; border-radius:16px; box-shadow: 0 8px 32px rgba(66,153,225,0.08); }
        /* event detail modal */
        .fc-event { cursor: pointer; }
        .event-modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(13,18,26,0.45); z-index:2000; }
        .event-modal-card { background:#fff; padding:20px 24px; border-radius:12px; width:90%; max-width:520px; box-shadow:0 24px 64px rgba(66,153,225,0.18); }
        .event-modal-card h3{ margin-bottom:8px; color:#2D3748; }
        .event-modal-close{ float:right; cursor:pointer; font-weight:700; color:#A0AEC0; }
    </style>
</head>
<body>

<!-- reuse the same navbar from home.html for consistency -->
<nav class="navbar">
    <div class="nav-left">
        <a href="#" class="logo-link">
            <img src="/static/images/Skillogo.png" alt="Skill Bridge Logo" class="logo">
        </a>
    </div>
    <div class="nav-right">
        <a href="{% url 'home' %}">Dashboard</a>
        <a href="{% url 'list_jobs' %}">Jobs</a>
        <a href="{% url 'list_trainings' %}">Trainings</a>
        <div class="underline"></div>
        <a>|</a>
        <a href="{% url 'edit_profile' %}">Profile</a>
        <a href="{% url 'login' %}" id="logoutLink">Logout</a>
    </div>
</nav>

<div class="calendar-wrapper" style="margin-top:140px;">
    <div class="calendar-header">
        <div class="calendar-title">Calendar — upcoming jobs & trainings</div>
        <div>
            <a href="{% url 'home' %}" class="btn-update" style="padding:10px 18px; font-size:0.95rem;">Back to Dashboard</a>
            <a href="{% url 'list_trainings' %}" class="action-btn" style="padding:10px 14px; margin-left:8px;">All Trainings</a>
        </div>
    </div>

    <div id="calendar"></div>
</div>

<!-- Event modal (hidden by default) -->
<div id="eventModal" class="event-modal hidden" style="display:none;">
    <div class="event-modal-card">
        <span id="closeModal" class="event-modal-close">&times;</span>
        <h3 id="evtTitle">Event</h3>
        <p id="evtDate" style="color:#718096;margin-bottom:8px;"></p>
        <p id="evtDesc" style="color:#2D3748;"></p>
        <div id="evtExtra" style="margin-top:12px;color:#4A5568;font-size:0.95rem;"></div>
    </div>
</div>

<!-- FullCalendar script -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek'
        },
        height: 'auto',
        events: {
            url: "{% url 'calendar_events' %}",
            method: 'GET',
            failure: function() {
                // show a floating message similar to your messages UI
                alert('Unable to load calendar data.');
            }
        },
        eventClick: function(info) {
            // Show modal with details
            const evt = info.event;
            const raw = evt.extendedProps.raw || {};

            document.getElementById('evtTitle').textContent = evt.title;
            // format date
            const start = evt.start;
            let dateStr = start ? start.toLocaleDateString() : (raw.date_scheduled || raw.dateposted || '');
            document.getElementById('evtDate').textContent = dateStr;

            // Description fallback from known fields
            let desc = raw.description || raw.Description || '';
            if (!desc && raw.training_name) desc = raw.training_name;
            if (!desc && raw.Title) desc = raw.Title;
            document.getElementById('evtDesc').textContent = desc;

            // Extra props
            let extra = '';
            if (evt.extendedProps.type === 'training') {
                extra = `Type: Training • Status: ${raw.status || 'N/A'}`;
            } else if (evt.extendedProps.type === 'job') {
                extra = `Type: Job • Status: ${raw.Status || 'N/A'}`;
            } else {
                extra = `Type: ${evt.extendedProps.type || 'event'}`;
            }
            document.getElementById('evtExtra').textContent = extra;

            const modal = document.getElementById('eventModal');
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
        }
    });

    calendar.render();

    // modal handlers
    const close = document.getElementById('closeModal');
    close.addEventListener('click', () => {
        const modal = document.getElementById('eventModal');
        modal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
        const modal = document.getElementById('eventModal');
        if (e.target === modal) modal.style.display = 'none';
    });
});
</script>

</body>
</html>
