{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Official Dashboard | SkillBridge</title>

    <link rel="stylesheet"href="{% static 'css/official/dashboard.css' %}?v=3"/>
    <link rel="stylesheet" href="{% static 'css/registration/logout.css' %}?v=3">
  </head>

  <body>
    <!-- ====================== NAVBAR ====================== -->
    <nav class="navbar">
      <div class="nav-left">
        <a href="{% url 'official_dashboard' %}" class="logo-link">
          <img
            src="/static/images/Skillogo.png"
            alt="Skill Bridge Logo"
            class="logo"
          />
        </a>
      </div>

      <div class="nav-right">
        <a href="{% url 'official_dashboard' %}" class="active">Dashboard</a>
        <a href="{% url 'verification_panel' %}">Verify Residents</a>

        <!-- Underline Element for Animation -->
        <div class="underline"></div>

        {% if official.role == "admin" or official.role == "moderator" %}
        <div><a href="{% url 'residents_list' %}">Residents</a></div>
        {% endif %}

        <!-- Logout -->
        <a href="{% url 'login' %}" id="logoutLink">Logout</a>
      </div>
    </nav>

    <!-- ================== Main ================== -->
    <main class="dashboard-main">
      <header class="dashboard-header">
        <h1 class="dashboard-title">Welcome, {{ official.name }}</h1>
      </header>

<!-- ================== Status & Messages ================== -->
{% if messages %}
<div class="floating-messages">
  {% for message in messages %}
  <div class="editprofile-message {% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

      <!-- ================= DASHBOARD CARDS ================= -->
      <div class="stats-grid">
        <a href="{% url 'residents_list' %}" class="stat-card">
          <h3 class="stat-title">Total Residents</h3>
          <p class="stat-number">{{ total_residents }}</p>
        </a>

        <div class="stat-card">
          <h3 class="stat-title">Pending Verifications</h3>
          <p class="stat-number">{{ pending_verifications|default:"0" }}</p>
        </div>
      </div>

      <!-- ================= JOB POSTS ================= -->
      <section id="jobs" class="section-block">
        <div class="section-header">
          <h2 class="section-title">Job Posts</h2>

          <a href="{% url 'post_job' %}" class="add-btn"> + Add Job </a>
        </div>

        {% if jobs %}
        <div class="cards-grid">
          {% for job in jobs %}
          <div class="job-card">
            <h3 class="job-title">Job Title: {{ job.Title }}</h3>

            <p class="job-description">Description: {{ job.Description|truncatechars:100 }}</p>

            {% if job.dateposted %}
            <p class="job-date">{{ job.dateposted|date:"M d, Y" }}</p>
            {% else %}
            <p class="job-date">No date</p>
            {% endif %}

            <span class="job-status">Status: {{ job.Status }}</span>

            <div class="job-actions">
              <a href="{% url 'update_job' job.JobID %}" class="job-edit"
                >Edit</a
              >
              <a
                href="{% url 'delete_job' job.JobID %}"
                class="job-delete"
                onclick="return confirm('Delete this job?')"
              >
                Delete
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="empty-text">No jobs posted yet.</p>
        {% endif %}
      </section>

      <!-- ================= TRAININGS ================= -->
      <section id="trainings" class="section-block">
        <div class="section-header">
          <h2 class="section-title">Training Events</h2>

          <a href="{% url 'post_training' %}" class="add-btn">
            + Add Training
          </a>
        </div>

        {% if trainings %}
        <div class="cards-grid">
          {% for t in trainings %}
          <a href="{% url 'training_attendees' t.id %}" class="training-card">
            <h3 class="training-title">{{ t.training_name }}</h3>

            <p class="training-date">{{ t.date_scheduled|date:"M d, Y" }}</p>

            <span class="training-slots"> {{ t.available_slots }} available slots ({{ t.registered_count }}/{{ t.slots }} registered) </span>
          </a>
          {% endfor %}
        </div>
        {% else %}
        <p class="empty-text">No training events posted yet.</p>
        {% endif %}
      </section>

      {% if official.role == "admin" or official.role == "moderator" %}
      <!-- ================= AUDIT LOGS ================= -->
      <section id="audit" class="section-block">
        <h2 class="section-title">Audit Logs</h2>

        {% if audits %}
        <p class="audit-placeholder">(Display logs here)</p>
        {% else %}
        <p class="empty-text">No audit logs yet.</p>
        {% endif %}
      </section>
      {% endif %}
    </main>

    <script>
      // Navbar underline animation
      const menuLinks = document.querySelectorAll(".nav-right a");
      const underline = document.querySelector(".nav-right .underline");

      function moveUnderline(el) {
        if (!underline) return;
        const rect = el.getBoundingClientRect();
        const parentRect = el.closest(".nav-right").getBoundingClientRect();
        underline.style.width = rect.width + "px";
        underline.style.left = rect.left - parentRect.left + "px";
      }

      const activeLink = document.querySelector(".nav-right a.active");
      if (activeLink) {
        setTimeout(() => moveUnderline(activeLink), 0);
      }

      menuLinks.forEach((link) => {
        link.addEventListener("mouseenter", (e) => {
          if (e.target.tagName === "A") moveUnderline(e.target);
        });
      });

      document
        .querySelector(".nav-right")
        .addEventListener("mouseleave", () => {
          if (activeLink) moveUnderline(activeLink);
        });



// Logout confirmation popup
const logoutLink = document.getElementById('logoutLink');

logoutLink.addEventListener('click', function(e) {
    e.preventDefault();

    const popup = document.createElement('div');
    popup.className = 'logout-popup';
    popup.innerHTML = `
        <p>Are you sure you want to end your session?</p>
        <div class="separator"></div>
        <div class="popup-buttons">
            <button id="cancelLogout">Cancel</button>
            <button id="confirmLogout">Yes</button>
        </div>
    `;
    document.body.appendChild(popup);

    document.getElementById('confirmLogout').addEventListener('click', () => {
        window.location.href = logoutLink.href;
    });

    document.getElementById('cancelLogout').addEventListener('click', () => {
        popup.classList.add('fade-out');
        setTimeout(() => popup.remove(), 500);
    });
});

    </script>

    <!-- Message auto-dismiss script -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const messages = document.querySelectorAll('.editprofile-message');
        messages.forEach(msg => {
            setTimeout(() => {
                msg.style.opacity = '0';
                msg.style.transform = 'translateX(50px)';
                setTimeout(() => msg.remove(), 500);
            }, 5000); // 5 seconds
        });
    });
    </script>
  </body>
</html>
